!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.htmlElement=t}var t,n,i;return t=e,(n=[{key:"updateEstimatedTime",value:function(e){try{(function(e){var t=e.querySelector(".mlp-new-site-schedule-steps__estimated-remaining-time");if(!t)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return t}(this.htmlElement)).innerText=e}catch(e){console.warn(e)}}},{key:"updateTotalAttachmentsNumber",value:function(e){try{(function(e){var t=e.querySelector(".mlp-new-site-schedule-steps__total-attachments");if(!t)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return t}(this.htmlElement)).innerText=e}catch(e){console.warn(e)}}},{key:"updateContent",value:function(e){try{(function(e){var t=e.querySelector(".mlp-attachment-schedule-notice__content");if(!t)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return t}(this.htmlElement)).innerHTML=e}catch(e){console.warn(e)}}},{key:"updateProgressBar",value:function(e){var t=e.stepsDone,n=void 0===t?0:t,r=e.allSteps,i=void 0===r?0:r;if(n&&i){var a=Math.floor(n/i*100);try{(function(e){var t,n=e.querySelector(".mlp-new-site-schedule-notice-progress");if(n&&(t=n.querySelector(".mlp-new-site-schedule-notice-progress__bar")),!t||void 0===t)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return t})(this.htmlElement).style.setProperty("width",a+"%")}catch(e){console.warn(e)}}}},{key:"remove",value:function(){this.htmlElement.remove()}},{key:"updateNoticeType",value:function(e){this.htmlElement.classList.remove("notice-info","notice-success","notice-error","notice-warning"),this.htmlElement.classList.add("notice-".concat(e))}},{key:"setStyleProperty",value:function(e,t){this.htmlElement.style.setProperty(e,t)}}])&&r(t.prototype,n),i&&r(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dOMDocument=t}var t,n,r;return t=e,(n=[{key:"dispatch",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.dOMDocument).trigger.apply(t,[e].concat(r))}}])&&a(t.prototype,n),r&&a(t,r),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jQuery=t,this.eventDispatcher=n,this.scheduleNoticeHtmlElement=r,this.scheduleStatusStorage=i}var t,n,r;return t=e,(n=[{key:"remove",value:function(){this.scheduleNoticeHtmlElement.remove()}},{key:"updateScheduleNoticeWithMessage",value:function(e,t){e&&(this.scheduleNoticeHtmlElement.updateContent(e),t&&this.scheduleNoticeHtmlElement.updateNoticeType(t))}},{key:"updateScheduleNoticeWithStatus",value:function(e){var t=e.schedule,n=e.estimatedRemainingTime,r=t.args.attachmentsNumber;this.scheduleNoticeHtmlElement.updateTotalAttachmentsNumber(r),this.scheduleNoticeHtmlElement.updateEstimatedTime(n),this.scheduleNoticeHtmlElement.updateProgressBar(t),this.scheduleStatusStorage.updateSetWithStatus(e),this.eventDispatcher.dispatch("multilingualpress.schedule_notice_updated",t)}},{key:"show",value:function(){this.scheduleNoticeHtmlElement.setStyleProperty("display","flex")}},{key:"hide",value:function(){this.scheduleNoticeHtmlElement.setStyleProperty("display","none")}}])&&s(t.prototype,n),r&&s(t,r),e}();var u=function e(t){var n=t.schedule,r=t.stepToFinish,i=t.estimatedRemainingTime;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schedule=n,this.stepToFinish=r,this.estimatedRemainingTime=i};function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleFactory=t}var t,n,r;return t=e,(n=[{key:"create",value:function(e){var t=Object.assign({},e),n=t.schedule,r=void 0===n?{}:n;t.schedule=this.scheduleFactory.create(r);var i=new u(t);return Object.freeze(i)}}])&&l(t.prototype,n),r&&l(t,r),e}();var f={isElement:function(e){return e instanceof Element},isUndefined:function(e){return void 0!==e},isFunction:function(e){return"function"==typeof e}};function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.translations=n,this.alert=r,this.eventCallback=this.preventFormSubmission.bind(this)}var t,n,r;return t=e,(n=[{key:"blockFormSubmission",value:function(){this.form.addEventListener("submit",this.eventCallback)}},{key:"releaseFormSubmission",value:function(){this.form.removeEventListener("submit",this.eventCallback)}},{key:"preventFormSubmission",value:function(e){e.preventDefault(),e.stopImmediatePropagation(),f.isUndefined(this.translations.preventFormSubmissionMessage)||this.alert(this.translations.preventFormSubmissionMessage)}}])&&d(t.prototype,n),r&&d(t,r),e}();function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.requestClient=t,this.scheduleStatusResponseHandler=n,this.form=r,this.domDocument=i,this.ajaxUrl=a,this.ajaxEvent=null}var t,n,r;return t=e,(n=[{key:"update",value:function(){var e=this;this.ajaxEvent=this.requestClient({url:this.ajaxUrl,complete:function(t,n){var r=t.responseJSON.success;if(["error","abort","parsererror"].includes(n))return!1;r&&e.delayUpdate()},success:function(t){return e.scheduleStatusResponseHandler.successHandler(t)},error:function(){return e.scheduleStatusResponseHandler.errorHandler()}})}},{key:"delayUpdate",value:function(){setTimeout(this.update,1e3)}},{key:"detachAjaxEvent",value:function(){this.ajaxEvent&&this.domDocument.off("ajaxSend",this.ajaxEvent)}}])&&m(t.prototype,n),r&&m(t,r),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b="multilingualpress.schedule_status_update_error",w=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleNotice=t,this.eventDispatcher=n,this.scheduleStatusFactory=r,this.form=i,this.translations=a}var t,n,r;return t=e,(n=[{key:"successHandler",value:function(e){var t=e.data,n=void 0===t?{}:t,r=e.success;if(void 0===r||!r)return this.scheduleNotice.remove(),void this.eventDispatcher.dispatch(b);this.scheduleNotice.show();var i=this.scheduleStatusFactory.create(n);this.scheduleNotice.updateScheduleNoticeWithStatus(i),this.eventDispatcher.dispatch("multilingualpress.schedule_status_updated",e)}},{key:"errorHandler",value:function(e,t,n){this.scheduleNotice.updateScheduleNoticeWithMessage(this.translations.scheduleInfoErrorMessage,"error"),this.eventDispatcher.dispatch(b,{message:n})}}])&&y(t.prototype,n),r&&y(t,r),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S="beforebegin",E=[S,"afterbegin","beforeend","afterend"],k=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!function(e){return E.includes(e)}(t))throw new Error('Position accept only the following values: "'.concat(E,'"'));this.position=t,this.selector=n,this.template=r}var t,n,r;return t=e,(n=[{key:"replaceInto",value:function(e){f.isElement(e)&&(this.removeFrom(e),this.insertInto(e))}},{key:"insertInto",value:function(e){f.isElement(e)&&e.insertAdjacentHTML(this.position,this.template)}},{key:"removeFrom",value:function(e){if(f.isElement(e)){var t=e.querySelector(this.selector);t&&t.remove()}}}])&&g(t.prototype,n),r&&g(t,r),e}();var j=function e(t){var n=t.sourceSiteId,r=t.newSiteId,i=t.attachmentsNumber;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sourceSiteId=n,this.newSiteId=r,this.attachmentsNumber=i};var T=function e(t){var n=t.id,r=t.stepsDone,i=t.allSteps,a=t.started,o=t.lastUpdate,s=t.args;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n,this.stepsDone=r,this.allSteps=i,this.started=a,this.lastUpdate=o,this.args=s};function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"create",value:function(e){var t=Object.assign({},e),n=t.args,r=void 0===n?{}:n;t.args=Object.freeze(new j(r));var i=new T(t);return Object.freeze(i)}}])&&N(t.prototype,n),r&&N(t,r),e}();var P=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t||!t)throw new Error("Expected nonce to be a string");if("string"!=typeof n||!n)throw new Error("Expected action to be a string");this.nonce=t,this.action=n};function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t,n,r,i,a,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.request=t,this.ajaxUrl=n,this.nonce=r,this.action=i,this.responseHandler=a,this.spinner=o}var t,n,r;return t=e,(n=[{key:"call",value:function(e,t){var n,r=this,i=t.schedule,a=(O(n={action:this.action},this.action,"stop_attachments_copy"),O(n,this.nonce.action,this.nonce.nonce),O(n,"scheduleId",i.id),O(n,"siteId",i.args.newSiteId),n);this.request({url:this.ajaxUrl,data:a,method:"POST",beforeSend:function(){return r.spinner.replaceInto(e.parentNode)},complete:function(){return r.spinner.removeFrom(e.parentNode)},success:function(e){return r.responseHandler.success(e)},error:function(e,t,n){return r.responseHandler.error(e,t,n)}})}}])&&x(t.prototype,n),r&&x(t,r),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H="multilingualpress.stop_attachment_duplication_succeed",F=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleNotice=t,this.eventDispatcher=n}var t,n,r;return t=e,(n=[{key:"success",value:function(e){var t=e.data.content,n=void 0===t?"":t,r=e.success,i=void 0!==r&&r;this.scheduleNotice.updateScheduleNoticeWithMessage(n,i?"success":"error"),i&&this.eventDispatcher.dispatch(H,e),!i&&this.eventDispatcher.dispatch("multilingualpress.stop_attachment_duplication_fails",e)}},{key:"error",value:function(e,t,n){this.scheduleNotice.updateScheduleNoticeWithMessage("".concat(t," : ").concat(n),"error")}}])&&C(t.prototype,n),r&&C(t,r),e}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.htmlElement=t,this.scheduleStatusFactory=n}var t,n,r;return t=e,(n=[{key:"updateSetWithStatus",value:function(e){this.htmlElement.dataset.currentSchedule=JSON.stringify(e)}},{key:"status",value:function(){return this.scheduleStatusFactory.create(JSON.parse(this.htmlElement.dataset.currentSchedule))}}])&&M(t.prototype,n),r&&M(t,r),e}();!function(e,t,n){if("site-new-php"===t)if(n)try{!function(){var e=document.querySelector("#mlp_new_site_schedule_tmpl");if(!e)throw new Error("Schedule Notice Template does not exists.");document.querySelector("#add-new-site").insertAdjacentHTML("afterend",e.innerHTML)}(),function(e){e.scheduleNotice.hide(),function(e){var t=e.stopAttachmentDuplicationProcessClient,n=e.domDocument,r=e.form,i=e.scheduleStatusUpdater,a=e.scheduleStatusStorage;window.addEventListener("load",(function(){return i.status()}),{once:!0});var o=document.querySelector("#mlp_kill_attachment_duplication");o&&o.addEventListener("click",(function(e){return t.call(e.currentTarget||e.target,a.status())})),n.on(b,(function(){return r.releaseFormSubmission()})),n.on(H,(function(e){var t=e.success;void 0!==t&&t&&(r.releaseFormSubmission(),i.detachAjaxEvent())}))}(e)}(function(){var t=n.scheduleUrl,r=n.ajaxUrl,a=void 0===r?"":r,s=e(document);if(!a)throw new TypeError("ajaxUrl must be set or schedule notice will not work");var u=function(){if(!n.hasOwnProperty("attachmentDuplicatorTranslations"))throw new Error("Translations for Site Duplication Schedule are missing");return n.attachmentDuplicatorTranslations}(),l=new p(function(){var e=document.querySelector("form");if(!e)throw new TypeError("No form exists in this page.");return e}(),u,alert),f=new o(s),d=new k(S,".spinner",'<span class="spinner is-active"></span>'),m=new _,y=new h(m),b=function(){var e=document.querySelector(".mlp-attachment-schedule-notice");if(!e)throw new TypeError("Impossible to retrieve the schedule notice html element. Element does not exists");return e=new i(e)}(),g=new U(b,y),E=new c(e,f,b,g),j=new w(E,f,y,l,u),T=new v(e.ajax,j,l,s,t),N=n.attachmentDuplicatorActions,O=N.nonce,x=N.nonceAction,C=N.nameAjaxHook,H=new F(E,f);return{domDocument:s,scheduleNotice:E,scheduleStatusStorage:g,scheduleStatusFactory:y,scheduleStatusResponseHandler:j,scheduleStatusUpdater:T,eventDispatcher:f,form:l,translations:u,spinner:d,ajaxUrl:a,stopAttachmentDuplicationProcessClient:new D(e.ajax,a,new P(O,x),C,H,d)}}())}catch(e){console.warn(e.message)}else console.warn("No schedule data available, duplication notice will not work as expected.")}(jQuery,adminpage,window.siteDuplicatorScheduleData)}]);